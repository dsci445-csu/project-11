---
title: "Predicting AirBnB Rental Rates"
author: "Trevor Isaacson, Jonathan Olavarria, Jasmine DeMeyer"
date: "12/10/2021"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width=5, fig.height=3) 
knitr::opts_chunk$set(message = FALSE)
library(ggplot2)
library(tidyverse)
library(tidyr)
library(e1071)
library(rmarkdown)
library(glmnet)
library(knitr)
library(leaps)
library(tree)
```

```{r}
original_df = read.csv("training_data.csv")
nrow(original_df)
head(original_df)
```

probably don't want the individual id of each place, its website url, description, amenities, name, zipcode (we have lat/long and city) and converted log_price to price
```{r}
training_df = original_df %>% 
  mutate(price = exp(log_price))  %>%
  select(-c(id, amenities, description, thumbnail_url, zipcode, name, X, log_price)) %>%
  mutate(first_review = as.Date(original_df$first_review, format = "%Y-%m-%d")) %>%
  mutate(last_review = as.Date(original_df$last_review, format = "%Y-%m-%d")) %>%
  mutate(host_since = as.Date(original_df$host_since, format = "%Y-%m-%d")) %>%
  mutate(host_response_rate = as.numeric(sub("%", "", original_df$host_response_rate))/100)
```

```{r}
head(training_df)
```

```{r}
# update 3 date columns to track the start of the week instead of the individual date
# create 3 new columns to track dates in the form of month instead of individual date
training_df = training_df %>%
  mutate(first_review = cut(training_df$first_review, "week")) %>%
  mutate(host_since = cut(training_df$host_since, "week")) %>%
  mutate(last_review = cut(training_df$last_review, "week")) %>%
  mutate(first_review_month = cut(training_df$first_review, "month")) %>%
  mutate(last_review_month = cut(training_df$last_review, "month")) %>%
  mutate(host_since_month = cut(training_df$host_since, "month")) %>%
  mutate(first_review_year = cut(training_df$first_review, "year")) %>%
  mutate(last_review_year = cut(training_df$last_review, "year")) %>%
  mutate(host_since_year = cut(training_df$host_since, "year"))

```

```{r}
head(training_df)
```

# Variable Descriptions:
## Price
```{r}
ggplot(data = training_df) +
  geom_histogram(aes(price), bins = 100) +
  ggtitle("Listing Price ($)") + 
  geom_vline(xintercept = median(training_df$price), color = "blue", lty = 2)

```

## Property Type
```{r}
training_df %>%
  group_by(property_type) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(room_type) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()
```

## City
```{r}
training_df %>%
  group_by(city) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total))

# latitude and longitude
ggplot(data = training_df) +
  geom_point(aes(x = longitude, y = latitude, color = city)) +
  ggtitle("Latitude and Longitude")

```



## Property Details
```{r}
training_df %>%
  group_by(accommodates) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(bedrooms) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(bathrooms) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(bed_type) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

```

## Host details
```{r}
training_df %>%
  group_by(host_has_profile_pic) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(host_identity_verified) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(instant_bookable) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) %>%
  kable()

training_df %>%
  group_by(cancellation_policy) %>%
  summarise(Total = n()) %>%
  arrange(desc(Total)) 
```


## Variable Selection?
Should we first choose we variables should be included in everybody's models or have everybody make their two models and then variable select based on the best model they found? 

Correlation Plot?
```{r}
head(training_df)

```







## Models
Do we want to split the training_data in half and make one half training and the other half available to use for CV testing and then the testing_data.csv is used for the final model predictions since it doesn't have a price column?
```{r}
trn = sample(seq_len(nrow(training_df)), 9000)
training = training_df[trn, ]
testing = training_df[-trn, ]
```


Baseline: Linear Regression
```{r}


```



JJ: PCR and PLS
Jasmine: Regression Splines/Generalized Additive Models



Trevor: Regression Trees/Bagging/Random Forests
```{r}
str(training_df)
initial_tree = tree(price ~ property_type + room_type + accommodates + bathrooms + bedType + cancellation_policy + cleaning_fee + city + host_has_profile_pic + host_identity_verified + host_response_rate + instant_bookable + latitude + longitude + number_of_reviews + review_scores_rating + bedrooms + beds + first_review_year + last_review_year + host_since_year, data = training)
summary(initial_tree)

```









## Final Model







## Results
Use best model and predict prices for a certain city and plot based on price (heatmap?)










